(function(a){a.bi={dataConsumers:[],dataRetrievers:[],dataManipulators:[],isInitialized:function(){return this._isInitialized},loadEnabled:function(){if(arguments.length>=1&&typeof arguments[0]=="boolean")this._loadEnabled=arguments[0];return this._loadEnabled},ignoreAttr:function(b){if(typeof b=="string"&&a.trim(b)!="")a.inArray(b,this._ignoreAttr)==-1&&this._ignoreAttr.push(b);else if(typeof b=="object")for(var c=0;c<b.length;c++){b[c]=a.trim(b[c]);a.inArray(b[c],this._ignoreAttr)==-1&&this._ignoreAttr.push(b[c])}},ignoreTextClass:function(c){if(typeof c=="string"&&a.trim(c)!="")for(var d=c.split(/\s+/),b=0;b<d.length;b++)a.inArray(d[b],this._ignoreTextClass)==-1&&this._ignoreTextClass.push(d[b])},baseData:function(){arguments.length>=1&&typeof arguments[0]=="object"&&a.extend(this._baseData,this._objectNametoLower(arguments[0]));return this._baseData},baseLoadData:function(){arguments.length>=1&&typeof arguments[0]=="object"&&a.extend(this._baseLoadData,this._objectNametoLower(arguments[0]));return this._baseLoadData},baseLinkData:function(){arguments.length>=1&&typeof arguments[0]=="object"&&a.extend(this._baseLinkData,this._objectNametoLower(arguments[0]));return this._baseLinkData},_objectNametoLower:function(b){var a={};for(var c in b)a[c.toLowerCase()]=b[c];return a},init:function(d){if(this.isInitialized())return;this._isInitialized=!0;this._ns=this.getNamespacePrefix("urn:schemas-microsoft-com:mscom:bi");this.ignoreAttr(this._ns+":track");var c=window.attachEvent?"click":"mousedown";a("a, area").live(c,a.proxy(function(e){var d=!0,g=a(e.currentTarget),b=g.attr(a.bi._ns+":track");b=b?b.toLowerCase():b;if(b&&(b==="true"||b==="false"))d=b=="true";else{var f=g.parents(":not(table)").filter(function(){var b=a(this).attr(a.bi._ns+":track");b=b?b.toLowerCase():b;return b&&(b==="true"||b==="false")?!0:!1});if(f.length)d=a(f[0]).attr(a.bi._ns+":track").toLowerCase()=="true"}if(d){var c=e.target;if(c.tagName.toLowerCase()=="area")c=a("img[usemap='#"+a(c).parent("map").attr("name")+"']").get(0);this.linkClick(e.currentTarget,c)}},this));for(var b in this.dataRetrievers)try{this.dataRetrievers[b].init()}catch(e){}for(var b in this.dataConsumers)try{this.dataConsumers[b].init(d[b])}catch(e){}this.loadEnabled()&&a(a.proxy(this.recordLoad,this))},record:function(b){b=a.extend({},this._baseData,b);for(var c in this.dataManipulators)try{this.dataManipulators[c].preRecord(b)}catch(d){}for(var c in this.dataConsumers)try{this.dataConsumers[c].record(b)}catch(d){}},recordLoad:function(b){if(b==a)b={};b=a.extend({},this._baseData,this._baseLoadData,b);for(var c in this.dataRetrievers)try{a.extend(b,this.dataRetrievers[c].getLoadData())}catch(d){}for(var c in this.dataManipulators)try{this.dataManipulators[c].preRecordLoad(b)}catch(d){}for(var c in this.dataConsumers)try{this.dataConsumers[c].recordLoad(b)}catch(d){}},linkClick:function(a,b){this.record(this.getLinkData(a,b))},getLinkData:function(c,d){var b=a.extend({},this._baseData,this._baseLinkData);for(var e in this.dataRetrievers)try{a.extend(b,this.dataRetrievers[e].getLinkData(c,d))}catch(f){}return b},getAttrData:function(g,i){var c={},b,f;if(jQuery&&g instanceof jQuery){for(var j=g,h=0,k=j.length;h<k;h++)for(var e=j.get(h).attributes,d=0,l=e.length;d<l;d++){b=e.item(d);f=b.name.toLowerCase();if(f.indexOf(a.bi._ns+":")===0&&(i||a.inArray(f,this._ignoreAttr)<0)){index=f.substring(3,b.name.length);if(c[index]==undefined)c[index]=[];a.inArray(b.value,c[index])<0&&c[index].push(b.value)}}for(var d in c)c[d]=c[d].join(";")}else for(var e=g.attributes,d=0,m=e.length;d<m;d++){b=e.item(d);if(b.name.indexOf(a.bi._ns+":")===0&&(i||a.inArray(b.name,this._ignoreAttr)<0))c[b.name.toLowerCase().substring(3,b.name.length)]=b.value}return c},getText:function(e){var d=a(e).html(),b=a("<div>"+d+"</div>");if(this._ignoreTextClass.length>0){var c="."+this._ignoreTextClass.join(",.");b.find(c).remove()}return a.trim(b.text())},mapData:function(d,b){if(!b)return!1;var e={};for(var a in b){e[a]="";for(var c=0,f=b[a].length;c<f;c++)if(b[a][c].str!==undefined)e[a]+=b[a][c].str;else if(b[a][c].bi&&d&&d[b[a][c].bi]!==undefined){switch(b[a][c].bi){case"uripath":if(d[b[a][c].bi]==""||d[b[a][c].bi]==null||d[b[a][c].bi]==undefined)d[b[a][c].bi]="/";else if(d[b[a][c].bi].substring(0,1)!="/")d[b[a][c].bi]="/"+d[b[a][c].bi];break;case"uriquery":if(d[b[a][c].bi]==""||d[b[a][c].bi]==null||d[b[a][c].bi]==undefined)d[b[a][c].bi]="?"}e[a]+=d[b[a][c].bi]}if(e[a]=="")delete e[a]}return e},isInteractionTypeValid:function(b,a){return!b||!a?!1:a.interactionTypeMap?!b.interactiontype||a.interactionTypeMap[b.interactiontype]!=undefined:!1},getNamespacePrefix:function(e){if(document.namespaces)for(var d=document.namespaces,b=0;b<d.length;b++)if(d[b].urn==e)return d[b].name;for(var c=a("html").get(0).attributes,b=0;b<c.length;b++)if(c[b].value==e)if(c[b].name.indexOf("xmlns:")==0)return c[b].name.substring(c[b].name.indexOf(":")+1)},_isInitialized:!1,_ns:"bi",_loadEnabled:!0,_ignoreAttr:[],_ignoreTextClass:[],_baseData:{},_baseLoadData:{interactiontype:0},_baseLinkData:{interactiontype:2}}})(jQuery)
